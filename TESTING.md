# LuckyTrans 测试计划

## 测试概述

本文档描述 LuckyTrans 的测试策略和测试用例。

## 单元测试

### OCR 功能测试

| 测试用例 | 描述 | 预期结果 |
|----------|------|----------|
| 空图像处理 | 传入空白 NSImage | 返回 OCRError.invalidImage |
| 无文本图像 | 传入纯色图像 | 返回 OCRError.noTextFound |
| 中文识别 | 识别中文文本 | 正确识别中文 |
| 英文识别 | 识别英文文本 | 正确识别英文 |
| 混合文本 | 中英混合文本 | 正确识别两种语言 |
| 多行文本 | 多行排版文本 | 正确保持行结构 |
| 置信度计算 | 检查置信度范围 | 0.0 - 1.0 |

### 取词功能测试

| 测试用例 | 描述 | 预期结果 |
|----------|------|----------|
| Safari 取词 | 从 Safari 获取选中文本 | 返回选中内容 |
| Chrome 取词 | 从 Chrome 获取选中文本 | 返回选中内容 |
| 普通应用取词 | 从 TextEdit 获取选中文本 | 返回选中内容 |
| 无权限取词 | 无辅助功能权限 | 返回 nil |
| 空选择 | 没有选中文本 | 返回 nil 或空字符串 |

### 翻译服务测试

| 测试用例 | 描述 | 预期结果 |
|----------|------|----------|
| OpenAI 翻译 | 有 API Key 时翻译 | 返回翻译结果 |
| Google 翻译 | 无需 API Key 翻译 | 返回翻译结果 |
| DeepL 翻译 | 有 API Key 时翻译 | 返回翻译结果 |
| 服务切换 | 切换翻译服务 | 使用新服务翻译 |
| 无配置翻译 | 无 API Key 时翻译 | 抛出 ServiceError |

## 集成测试

### 端到端翻译流程

1. **用户选中英文文本** → 按快捷键 → 显示中文翻译
2. **用户截图图片** → OCR 识别 → 翻译识别结果
3. **用户在浏览器选中文本** → AppleScript 获取 → 翻译

### UI 测试

| 测试用例 | 描述 | 预期结果 |
|----------|------|----------|
| 设置界面打开 | 打开偏好设置 | 显示所有设置项 |
| 服务选择 | 选择不同翻译服务 | 显示对应配置项 |
| API Key 保存 | 保存 API Key | 正确保存并可读取 |
| 快捷键录制 | 录制新快捷键 | 正确注册新快捷键 |

## 手动测试清单

### 基础功能

- [ ] 应用正常启动
- [ ] 快捷键触发翻译
- [ ] 浮动窗口正确显示
- [ ] 翻译结果正确显示
- [ ] 窗口自动关闭

### OCR 功能

- [ ] 截图翻译正常工作
- [ ] 识别中文文本正确
- [ ] 识别英文文本正确
- [ ] 混合文本处理正确

### 浏览器取词

- [ ] Safari 取词正常
- [ ] Chrome 取词正常
- [ ] Edge 取词正常

### 多服务支持

- [ ] Google 翻译正常工作
- [ ] DeepL 翻译正常工作（需要 API Key）
- [ ] OpenAI 翻译正常工作
- [ ] 服务切换正常

### 设置界面

- [ ] 可以切换翻译服务
- [ ] 可以保存 API Key
- [ ] 可以修改快捷键
- [ ] 可以切换主题

## 性能测试

| 指标 | 目标 | 测试方法 |
|------|------|----------|
| OCR 识别速度 | < 3 秒 | 识别包含 100 字的图片 |
| 翻译响应时间 | < 2 秒 | 翻译 100 字文本 |
| 取词响应时间 | < 500ms | 从获取文本到显示窗口 |
| 内存占用 | < 100MB | 运行 1 小时后的内存 |

## 测试命令

```bash
# 构建项目
swift build

# 运行应用
swift run

# 构建发布版本
swift build -c release
```

## 注意事项

1. **辅助功能权限**：取词功能需要授予辅助功能权限
2. **屏幕录制权限**：截图功能需要授予屏幕录制权限
3. **网络连接**：翻译服务需要网络连接
4. **API Key**：部分服务需要有效的 API Key
